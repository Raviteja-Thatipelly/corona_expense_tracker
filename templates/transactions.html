{% extends 'base.html' %}
{% load static %}

<title>{% block title %} expenses manager {% endblock %}</title>

{% block content %}

<!-- partial -->
<div class="main-panel">
  <div class="content-wrapper">
    <div class="page-header d-flex justify-content-between align-items-center">
      <h3 class="page-title"> Transactions </h3>
      <nav>
        <ol><button type="button" class="btn-primary btn" data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">Add Transaction</button>
        </ol>
      </nav>
    </div>
    <div class="row">
      <div class="col-lg-12 grid-margin stretch-card">
        <div class="card">
          <div class="card-body">
            <h4 class="card-title">Transaction Table</h4>
            <!-- <p class="card-description"> Add class <code>.table</code> -->
            <!-- </p> -->
            <div class="table-responsive">
              <table id="transactionTable" class="table table-striped table-dark table-bordered js-grid">
                <thead>
                  <tr>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Amount</th>
                    <th>Type</th>
                    <th>Payment Mode</th>
                    <th>Date</th>
                    <th>Invoice</th>
                    <th> Actions </th>
                  </tr>
                </thead>
                <tbody>
                  {% for transaction in transactions %}
                  <tr data-category="{{transaction.category|lower}}">
                    <td>{{ transaction.name }}</td>
                    <td>{{ transaction.category }}</td>
                    <td>{{ transaction.amount }}</td>
                    <td>{{ transaction.type }}</td>
                    <td>{{ transaction.mode_of_payment }}</td>
                    <td>{{ transaction.amount }}</td>
                    <td>{{ transaction.date }}</td>
                    <td>
                      {% if transaction.invoice %}
                      <a href="{{ transaction.invoice.url }}" target="_blank">View</a>
                      {% else %}
                      No file
                      {% endif %}
                    </td>
                    <td class="jsgrid-cell jsgrid-control-field jsgrid-align-center" style="width: 50px;">
                      <input class="jsgrid-button jsgrid-edit-button" type="button" title="Edit">
                      <input class="jsgrid-button jsgrid-delete-button" type="button" title="Delete">
                    </td>
                  </tr>
                  {% empty %}
                  <tr>
                    <td colspan="8">No transactions found.</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>



  <!-- Form for adding a new transaction -->

  <div class="offcanvas offcanvas-end" data-bs-scroll="true" data-bs-backdrop="true" tabindex="-1" id="offcanvasWithBothOptions"
    aria-labelledby="offcanvasWithBothOptionsLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasWithBothOptionsLabel">Add Transactions</h5>
      <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>

    <div class="offcanvas-body">
    <form method="POST" action="{% url 'transactions' %}" enctype="multipart/form-data">
      {% csrf_token %}
      
        {% if messages %}
          {% for message in messages %}
          <div class="alert alert-{{ message.tags }}">{{ message }}</div>
          {% endfor %}
        {% endif %}

        <!-- <div class="row"> -->

          <div class="col-lg-12 mb-3">
            <label class="form-label">Name</label>
            <input type="text" name="name" class="form-control" required>
          </div>

          <div class="col-lg-12 mb-3">
            <label class="form-label">Category:</label>
            <select name="category" class="form-select text-white bg-dark" required>
              <option value="food"> Food </option>
              <option value="shopping"> Shopping </option>
              <option value="bills"> Bills </option>
              <option value="travel"> Travel </option>
              <option value="others"> Others </option>
            </select>
          </div>

          <div class="col-lg-12 mb-3">
            <label>Amount:</label>
            <input type="number" name="amount" step="0.01" required>

          </div>

          <div class="col-lg-12 mb-3">
            <label class="form-label">Type:</label>
            <select name="type" class="form-select text-white bg-dark" required>
              <option value="income">Income</option>
              <option value="expense">Expense</option>
            </select>
          </div>

          <div class="col-lg-12 mb-3">
            <label>Payment Mode:</label>
            <select name="mode_of_payment" class="form-select text-white bg-dark">
              <option value="cash">Cash</option>
              <option value="card">Card</option>
              <option value="bank">Bank Transfer</option>
            </select>

          </div>

          <div class="col-lg-12 mb-3">
            <label class="form-label">Date:</label>
            <input type="datetime-local" name="date" class="form-control">

          </div>

          <div class="col-lg-12 mb-3">
            <label class="form-label">Upload Invoice:
              <input type="file" name="invoice" class="form-control">
            </label>
          </div>

          <div class="d-flex justify-content-end gap-2 mt-3">
            <button type="submit" class="btn btn-primary">Add Transaction</button>

            <button type="button" class="btn btn-secondary" data-bs-dismiss="offcanvas"> Cancel </button>
          </div>
          
    </form>

  </div>

</div>

{% endblock %}